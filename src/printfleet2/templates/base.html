<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}PrintFleet2{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename=theme_css) }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>
  <body>
    <header class="site-header">
      <div class="container nav">
        <div class="brand">
          <span class="brand-mark"></span>
          <span class="brand-name">PrintFleet2</span>
        </div>
        <nav class="nav-links">
          <a href="/">Home</a>
          {% if request.path != "/live-wall" and g.user %}
            <a href="/printer-dashboard">Printer dash</a>
            <a href="/printer-just">Just Print</a>
          {% endif %}
          {% if request.path != "/live-wall" %}
            <a href="/live-wall">Live-Wall</a>
            <a href="/printers">Printers</a>
            <details class="nav-dropdown">
              <summary class="nav-trigger">Management</summary>
              <div class="nav-menu">
                <a href="/printer-groups">Printer groups</a>
                <a href="/printer-types">Printer types</a>
                <a href="/users">Users</a>
                <a href="/settings">Settings</a>
                <a href="/logs">Logs</a>
              </div>
            </details>
            <a href="/login" id="authLink" class="ghost">Login</a>
          {% endif %}
        </nav>
      </div>
    </header>

    <main class="site-main">
      {% block content %}{% endblock %}
    </main>

    <footer class="site-footer">
      <div class="container footer">
        <span>PrintFleet2</span>
        <span class="muted"><a href="https://www.know-how-schmiede.de" target="_blank">(c) Know-How-Schmiede</a></span>
        <span class="muted">Version {{ app_version }}</span>
      </div>
    </footer>

    <script>
      (async function() {
        const authLink = document.getElementById("authLink");
        if (!authLink) return;
        try {
          const res = await fetch("/api/auth/me", { credentials: "same-origin" });
          if (res.ok) {
            const data = await res.json();
            if (data && data.user) {
              authLink.textContent = "Logout";
              authLink.href = "/logout";
            }
          }
        } catch (err) {
          /* ignore */
        }
      })();
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
